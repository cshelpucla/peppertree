<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Rental Application - PepperTree Townhomes</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="admin-auth.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 16px; /* Prevents iOS zoom on input focus */
            line-height: 1.5;
            position: relative; /* Ensure sticky positioning works relative to body */
            overflow-x: hidden; /* Prevent horizontal scroll on body */
            overflow-y: auto; /* Allow vertical scrolling */
        }

        .form-container {
            background: #f8f9fa;
            padding: 0;
            min-height: 100vh;
            position: relative; /* Required for sticky children */
        }
        
        .form-wrapper {
            background: white;
            border-radius: 0;
            box-shadow: none;
            overflow: visible; /* CRITICAL: Changed from 'hidden' to allow sticky positioning */
            margin: 0 auto;
            max-width: 100%;
        }
        
        /* Ultra-compact sticky header with integrated navigation */
        .form-header {
            background: linear-gradient(135deg, #2c5530 0%, #4a7c59 100%);
            color: white;
            padding: 0.35rem 0.5rem 0.35rem;
            text-align: center;
            position: -webkit-sticky; /* Safari support */
            position: sticky;
            top: 0;
            left: 0;
            right: 0;
            width: 100%;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        
        .form-header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 1.2rem;
            margin-bottom: 0.15rem;
            font-weight: 700;
            line-height: 1.1;
        }
        
        .form-header .subtitle {
            font-size: 0.75rem;
            opacity: 0.9;
            margin: 0 0 0.35rem 0;
            font-weight: 400;
        }
        
        /* Progress bar */
        .progress-bar {
            background: rgba(255,255,255,0.25);
            height: 4px;
            margin-top: 0.35rem;
            border-radius: 2px;
            overflow: hidden;
        }
        
        .progress-fill {
            background: white;
            height: 100%;
            width: 0%;
            transition: width 0.4s ease-out;
            box-shadow: 0 0 8px rgba(255,255,255,0.5);
        }

        /* Step indicator */
        .step-indicator {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.3rem;
            margin-top: 0.35rem;
            margin-bottom: 0.5rem;
            font-size: 0.75rem;
            opacity: 0.95;
            font-weight: 500;
        }
        
        /* Section Navigator - NOW INSIDE THE GREEN HEADER */
        .section-navigator {
            background: transparent; /* Transparent to show green background */
            border-bottom: none;
            padding: 0.5rem 0 0.35rem;
            overflow-x: auto;
            overflow-y: visible;
            -webkit-overflow-scrolling: touch;
            margin-top: 0.35rem;
        }
        
        .nav-tabs {
            display: flex;
            gap: 0.5rem;
            min-width: max-content;
            padding: 0 0.5rem;
        }
        
        /* Second row of navigation tabs */
        .nav-tabs-row2 {
            margin-top: 0.35rem;
        }
        
        .nav-tab {
            flex: 1;
            min-width: 85px;
            padding: 0.4rem 0.5rem;
            background: rgba(255, 243, 205, 0.95); /* Semi-transparent orange for incomplete */
            border: 2px solid #ffc107;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 0.75rem;
            font-weight: 600;
            color: #856404;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.2rem;
            position: relative;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
        }
        
        .nav-tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .nav-tab.active {
            background: rgba(207, 226, 255, 0.95); /* Semi-transparent blue for active */
            border-color: #0d6efd;
            color: #084298;
            box-shadow: 0 4px 14px rgba(13, 110, 253, 0.4);
            transform: scale(1.08);
        }
        
        .nav-tab.completed {
            background: rgba(209, 231, 221, 0.95); /* Semi-transparent green for completed */
            border-color: #28a745;
            color: #0a3622;
        }
        
        .nav-tab.completed::after {
            content: "✓";
            position: absolute;
            top: 0.15rem;
            right: 0.15rem;
            background: #28a745;
            color: white;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
        }
        
        .nav-tab-icon {
            font-size: 1.2rem;
            display: block;
        }
        
        .nav-tab-label {
            font-size: 0.75rem;
            line-height: 1.1;
            display: block;
        }
        
        /* Hide scrollbar but keep functionality for navigator */
        .section-navigator::-webkit-scrollbar {
            height: 3px;
        }
        
        .section-navigator::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.2);
        }
        
        .section-navigator::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.5);
            border-radius: 2px;
        }
        
        .section-navigator::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.7);
        }
        
        .form-content {
            padding: 1.25rem 1rem 6rem;
            max-width: 900px;
            width: 100%;
            margin: 0 auto;
        }
        
        /* Single-column layout for mobile */
        .form-section {
            margin-bottom: 1.75rem;
            padding: 1.25rem 1rem;
            background: white;
            border-radius: 12px;
            border: 1px solid #dee2e6;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .form-section h3 {
            color: #2c5530;
            margin: 0 0 1.25rem 0;
            font-weight: 600;
            font-size: 1.15rem;
            display: flex;
            align-items: center;
            gap: 0.625rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid #4a7c59;
        }
        
        .section-icon {
            font-size: 1.3rem;
        }
        
        .section-description {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
            font-style: italic;
        }
        
        .occupant-group {
            padding: 0.5rem 0.75rem;
            margin-bottom: 0.75rem;
            background: #f8f9fa;
            border-radius: 4px;
            border-left: 3px solid #4a7c59;
        }
        
        .occupant-group:last-of-type {
            margin-bottom: 0;
        }
        
        .occupant-labels {
            display: flex;
            gap: 1rem;
            margin-bottom: 0.3rem;
        }
        
        .occupant-labels label {
            flex: 1;
            font-weight: 600;
            font-size: 0.8rem;
            color: #2c5530;
        }
        
        .occupant-inputs {
            display: flex;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }
        
        .occupant-inputs .form-group {
            flex: 1;
            margin-bottom: 0 !important;
        }
        
        .occupant-inputs .form-group label {
            display: none;
        }
        
        .occupant-inputs .form-group:first-child {
            flex: 1;
        }
        
        .occupant-inputs .form-group:nth-child(2) {
            flex: 0 0 auto;
            max-width: 160px;
        }
        
        .occupant-inputs .form-group:nth-child(2) input {
            max-width: 160px;
        }
        
        .occupant-labels label:nth-child(2) {
            flex: 0 0 auto;
            max-width: 160px;
        }
        
        /* Always single column on mobile */
        .form-row {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 0.75rem;
            grid-template-columns: 1fr;
        }
        
        /* Two-column layout for specific rows */
        .form-row.two-col {
            flex-direction: row;
            gap: 1rem;
        }
        
        .form-row.two-col .form-group {
            flex: 1;
            min-width: 0;
        }
        
        .form-row.two-col .form-group label {
            min-width: 60px;
            max-width: 100px;
            flex-shrink: 0;
            font-size: 0.75rem;
        }
        
        .form-row.two-col .form-group input,
        .form-row.two-col .form-group select {
            flex: 1;
            min-width: 0;
            width: 100%;
        }
        
        .form-group {
            width: 100%;
            display: flex;
            flex-direction: row !important;
            align-items: center;
            gap: 0.75rem;
        }
        
        .form-group label {
            display: inline-block;
            margin-bottom: 0;
            font-weight: 600;
            color: #333;
            font-size: 0.8rem;
            white-space: nowrap;
            flex-shrink: 0;
            min-width: 120px;
            max-width: 180px;
            text-align: left;
        }
        
        .form-group.full-width label {
            min-width: 100px;
        }
        
        .required {
            color: #dc3545;
            margin-left: 2px;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            flex: 1;
            padding: 0.7rem; /* Reduced by 30% from 1rem */
            min-height: 34px; /* Reduced by 30% from 48px */
            border: 2px solid #dee2e6; /* Thicker border for better visibility */
            border-radius: 10px;
            font-size: 16px; /* Prevents zoom on iOS */
            transition: all 0.2s ease;
            background: white;
            -webkit-appearance: none;
            appearance: none;
            font-family: 'Montserrat', sans-serif;
        }
        
        /* Input validation states */
        .form-group input:valid:not(:placeholder-shown),
        .form-group select:valid,
        .form-group textarea:valid:not(:placeholder-shown) {
            border-color: #28a745;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%2328a745' viewBox='0 0 16 16'%3E%3Cpath d='M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            padding-right: 2.5rem;
        }
        
        .form-group input:invalid:not(:placeholder-shown):not(:focus) {
            border-color: #dc3545;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #4a7c59;
            box-shadow: 0 0 0 4px rgba(74, 124, 89, 0.15); /* Larger focus ring */
            transform: scale(1.01); /* Subtle scale for feedback */
        }
        
        .form-group select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 16 16'%3E%3Cpath fill='%23333' d='M8 11L3 6h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            padding-right: 3rem;
        }
        
        .form-group textarea {
            min-height: 84px; /* Reduced by 30% from 120px */
            resize: vertical;
        }
        
        /* Better checkbox and radio button styling - Compact & Modern */
        .checkbox-group,
        .radio-group {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }
        
        .checkbox-group label,
        .radio-group label {
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 400;
            font-size: 0.875rem;
            cursor: pointer;
            padding: 0.4rem 0.75rem;
            min-height: 38px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            transition: all 0.2s ease;
            margin: 0;
            flex: 1;
            min-width: 80px;
            background: white;
            position: relative;
        }
        
        .checkbox-group label:hover,
        .radio-group label:hover {
            border-color: #4a7c59;
            background: #f0f7f4;
        }
        
        /* Hide the actual radio button and checkbox inputs */
        .checkbox-group input[type="checkbox"],
        .radio-group input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
            margin: 0;
            padding: 0;
        }
        
        /* Active/checked state - Button-style with checkmark icon */
        .checkbox-group label:has(input:checked),
        .radio-group label:has(input:checked) {
            background: #4a7c59;
            color: white;
            border-color: #4a7c59;
            font-weight: 600;
        }
        
        /* Add checkmark before text when checked */
        .radio-group label:has(input:checked)::before {
            content: "✓ ";
            margin-right: 0.25rem;
            font-weight: bold;
        }
        
        /* Yes/No question single-line layout */
        .yes-no-question {
            display: grid;
            grid-template-columns: 1fr auto;
            align-items: center;
            gap: 1rem;
            width: 100%;
        }
        
        .yes-no-question label {
            font-size: 0.85rem;
            font-weight: 500;
            margin: 0;
            color: #333;
            line-height: 1.5;
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
            max-width: 100%;
        }
        
        .yes-no-label {
            font-size: 0.8rem;
            font-weight: 600;
            margin: 0;
            color: #333;
            line-height: 1.4;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .inline-radio {
            display: flex;
            gap: 0.4rem;
            margin: 0;
            flex-shrink: 0;
            white-space: nowrap;
        }
        
        .inline-radio label {
            min-width: 48px;
            padding: 0.3rem 0.5rem;
            font-size: 0.75rem;
        }
        
        /* Enhanced action buttons with larger touch targets */
        .form-actions {
            background: white;
            padding: 1.25rem 1rem;
            border-top: 2px solid #e9ecef;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 90;
            box-shadow: 0 -4px 16px rgba(0,0,0,0.1);
        }
        
        .btn-group {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            gap: 0.5rem;
            max-width: 800px;
            margin: 0 auto;
            justify-content: center;
        }
        
        .btn-form {
            padding: 1rem 1.5rem;
            min-height: 52px; /* Large touch target */
            border: none;
            border-radius: 10px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
            cursor: pointer;
            font-size: 0.95rem;
            flex: 1;
            min-width: 140px;
            text-align: center;
            font-family: 'Montserrat', sans-serif;
        }
        
        .btn-primary {
            background: #4a7c59;
            color: white;
            box-shadow: 0 4px 12px rgba(74, 124, 89, 0.3);
        }
        
        .btn-primary:hover,
        .btn-primary:active {
            background: #2c5530;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(74, 124, 89, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover,
        .btn-secondary:active {
            background: #495057;
            transform: translateY(-1px);
        }
        
        .btn-outline {
            background: transparent;
            color: #4a7c59;
            border: 2px solid #4a7c59;
        }
        
        .btn-outline:hover,
        .btn-outline:active {
            background: #4a7c59;
            color: white;
        }
        
        /* Input hints and help text */
        .input-hint {
            font-size: 0.7rem;
            color: #6c757d;
            display: block;
            line-height: 1.4;
            margin-top: 0.25rem;
            margin-left: 128px;
            width: 100%;
            flex-basis: 100%;
        }
        
        .input-hint::before {
            content: "ℹ️ ";
        }
        
        /* Form groups with hints need to wrap */
        .form-group:has(.input-hint) {
            flex-wrap: wrap;
        }
        
        /* Special handling for form groups with radio buttons or textareas */
        .form-group:has(.radio-group),
        .form-group:has(textarea) {
            flex-direction: column;
            align-items: flex-start;
        }
        
        .form-group:has(.radio-group) label,
        .form-group:has(textarea) label {
            margin-bottom: 0.5rem;
        }
        
        .form-group textarea {
            width: 100%;
            min-height: 80px;
        }
        
        /* Error messages */
        .error-message {
            font-size: 0.8125rem;
            color: #dc3545;
            margin-top: 0.375rem;
            display: none;
            align-items: flex-start;
            gap: 0.375rem;
        }
        
        .error-message.show {
            display: flex;
        }
        
        .error-message::before {
            content: "⚠️";
            flex-shrink: 0;
        }
        
        /* Success message */
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
            align-items: center;
            gap: 0.5rem;
        }
        
        .success-message.show {
            display: flex;
        }
        
        .success-message::before {
            content: "✅";
            font-size: 1.25rem;
        }
        
        .collapsible-section {
            margin-bottom: 0.5rem;
        }
        
        .section-toggle {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }
        
        .section-toggle:hover {
            background: #e9ecef;
        }
        
        .section-toggle.active {
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
            background: white;
            border-color: #4a7c59;
        }
        
        .toggle-icon {
            transition: transform 0.3s ease;
            font-weight: bold;
        }
        
        .toggle-icon.active {
            transform: rotate(180deg);
        }
        
        .section-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            border: 1px solid #dee2e6;
            border-top: none;
            border-bottom-left-radius: 8px;
            border-bottom-right-radius: 8px;
        }
        
        .section-content.active {
            max-height: 5000px;
            padding: 1rem;
            background: white;
        }
        
        .save-draft-btn {
            position: fixed;
            bottom: 80px;
            right: 1rem;
            background: white;
            color: #4a7c59;
            border: 2px solid #4a7c59;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            cursor: pointer;
            z-index: 80;
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .save-draft-btn:hover {
            transform: scale(1.1);
            background: #4a7c59;
            color: white;
        }
        
        /* Desktop Styles */
        @media (min-width: 768px) {
            .form-wrapper {
                margin: 2rem auto;
                border-radius: 12px;
                box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            }
            
            .form-header {
                border-radius: 12px 12px 0 0;
                padding: 2rem;
                position: relative;
            }
            
            .form-header h1 {
                font-size: 2.5rem;
                margin-bottom: 0.5rem;
            }
            
            .form-header .subtitle {
                font-size: 1.1rem;
            }
            
            .form-content {
                padding: 2rem;
            }
            
            .form-section {
                padding: 1.5rem;
                background: #f8f9fa;
                border-left: 4px solid #4a7c59;
            }
            
            .form-section h3 {
                font-size: 1.3rem;
            }
            
            .form-row {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .form-row.three-col {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .form-row.four-col {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .form-group.full-width {
                grid-column: 1 / -1;
            }
            
            .form-actions {
                padding: 2rem;
                position: relative;
            }
            
            .save-draft-btn {
                display: none;
            }
        }
        
        /* Tablet landscape */
        @media (min-width: 992px) {
            .form-wrapper {
                max-width: 900px;
            }
        }
        
        /* Hide number input spinners on mobile */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        input[type="number"] {
            -moz-appearance: textfield;
        }
        
        /* Better touch targets */
        @media (max-width: 767px) {
            input, select, textarea, button {
                min-height: 48px;
            }
        }
        
        /* Loading state */
        .form-loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .form-loading.active {
            display: flex;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4a7c59;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Success message */
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
            border: 1px solid #c3e6cb;
        }
        
        .success-message.active {
            display: block;
        }
        
        /* Error message */
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
            border: 1px solid #f5c6cb;
        }
        
        .error-message.active {
            display: block;
        }
        
        .required {
            color: #dc3545;
        }
        
        .form-note {
            background: #e8f5e8;
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 2rem;
            border-left: 4px solid #4a7c59;
            font-size: 0.9rem;
            color: #2c5530;
        }
        
        /* Yes/No button styles */
        .yes-no-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .yes-no-btn {
            padding: 0.4rem 1rem;
            border: 2px solid #dee2e6;
            background: white;
            color: #495057;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.2s ease;
            min-width: 60px;
        }
        
        .yes-no-btn:hover {
            border-color: #2c5530;
            background: #f8f9fa;
        }
        
        .yes-no-btn.active {
            background: #2c5530;
            color: white;
            border-color: #2c5530;
        }
        
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }
            
            .form-group {
                min-width: auto;
            }
            
            .btn-group {
                flex-direction: column;
                align-items: center;
            }
            
            .btn-form {
                width: 100%;
                max-width: 250px;
                justify-content: center;
            }
            
            /* Hide Print and PDF buttons on mobile */
            .btn-form.btn-outline {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="nav-brand">PepperTree Townhomes</a>
            <button class="nav-toggle" id="navToggle">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <ul class="nav-menu" id="navMenu">
                <li><a href="index.html">Home</a></li>
                <li><a href="neighborhood.html">Neighborhood</a></li>
                <li><a href="applications-list.html">Applications</a></li>
                <li><a href="rental-application.html">Apply Now</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li><a href="#" id="authNavLink" class="auth-nav-link">Sign In</a></li>
            </ul>
        </div>
    </nav>

    <!-- Form Container -->
    <div class="form-container">
        <div class="form-wrapper">
            <div class="form-header">
                <h1>📝 Rental Application</h1>
                <p class="subtitle">PepperTree Townhomes - Quick & Easy</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="step-indicator">
                    <span id="currentStep">0%</span> Complete
                </div>
                
                <!-- Section Navigator - NOW INSIDE GREEN HEADER -->
                <div class="section-navigator">
                    <div class="nav-tabs" id="sectionTabs">
                        <!-- Row 1: Primary Sections -->
                        <div class="nav-tab" data-section="personal" onclick="scrollToSection('personal')">
                            <span class="nav-tab-icon">👤</span>
                            <span class="nav-tab-label">Personal</span>
                        </div>
                        <div class="nav-tab" data-section="contact" onclick="scrollToSection('contact')">
                            <span class="nav-tab-icon">📱</span>
                            <span class="nav-tab-label">Contact</span>
                        </div>
                        <div class="nav-tab" data-section="address" onclick="scrollToSection('address')">
                            <span class="nav-tab-icon">🏠</span>
                            <span class="nav-tab-label">Address</span>
                        </div>
                        <div class="nav-tab" data-section="occupants" onclick="scrollToSection('occupants')">
                            <span class="nav-tab-icon">👥</span>
                            <span class="nav-tab-label">Occupants</span>
                        </div>
                        <div class="nav-tab" data-section="employment" onclick="scrollToSection('employment')">
                            <span class="nav-tab-icon">💼</span>
                            <span class="nav-tab-label">Employment</span>
                        </div>
                        <div class="nav-tab" data-section="references" onclick="scrollToSection('references')">
                            <span class="nav-tab-icon">📋</span>
                            <span class="nav-tab-label">References</span>
                        </div>
                    </div>
                    <!-- Row 2: Additional Sections -->
                    <div class="nav-tabs nav-tabs-row2" id="sectionTabsRow2">
                        <div class="nav-tab" data-section="pets" onclick="scrollToSection('pets')">
                            <span class="nav-tab-icon">🐾</span>
                            <span class="nav-tab-label">Pets</span>
                        </div>
                        <div class="nav-tab" data-section="vehicle" onclick="scrollToSection('vehicle')">
                            <span class="nav-tab-icon">🚗</span>
                            <span class="nav-tab-label">Vehicle</span>
                        </div>
                        <div class="nav-tab" data-section="emergency" onclick="scrollToSection('emergency')">
                            <span class="nav-tab-icon">🚨</span>
                            <span class="nav-tab-label">Emergency</span>
                        </div>
                        <div class="nav-tab" data-section="additional" onclick="scrollToSection('additional')">
                            <span class="nav-tab-icon">📅</span>
                            <span class="nav-tab-label">Additional</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="form-content">
                <div class="success-message" id="successMessage">
                    ✅ Form saved successfully!
                </div>
                
                <div class="error-message" id="errorMessage">
                    ⚠️ Please fill in all required fields
                </div>
                
                <!-- 
                    FORM SUBMISSION: This form collects all data and sends it via email to rent@peppertreetownhomes.com
                    Method: mailto link with comprehensive application data
                    Alternative: You can integrate with FormSubmit, EmailJS, or a backend service for server-side email
                -->
                <form id="rentalApplicationForm" onsubmit="handleFormSubmission(event)" method="POST">
                    <!-- Hidden fields for email routing -->
                    <input type="hidden" name="_to" value="rent@peppertreetownhomes.com">
                    <input type="hidden" name="_subject" value="New Rental Application - PepperTree Townhomes">
                    
                    <!-- Personal Information -->
                    <div class="form-section" id="section-personal" data-section="personal">
                        <h3><span class="section-icon">👤</span> Personal Information</h3>
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="firstName">First Name <span class="required">*</span></label>
                                <input type="text" id="firstName" name="firstName" required autocomplete="given-name">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="middleName">Middle Name</label>
                                <input type="text" id="middleName" name="middleName" autocomplete="additional-name">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="lastName">Last Name <span class="required">*</span></label>
                                <input type="text" id="lastName" name="lastName" required autocomplete="family-name">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="dateOfBirth">Date of Birth <span class="required">*</span></label>
                                <input type="date" id="dateOfBirth" name="dateOfBirth" required autocomplete="bday">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="socialSecurity">Social Security # <span class="required">*</span></label>
                                <input type="text" id="socialSecurity" name="socialSecurity" placeholder="XXX-XX-XXXX" required pattern="\d{3}-\d{2}-\d{4}" inputmode="numeric">
                                <span class="input-hint">Your SSN is required for background and credit checks</span>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="driversLicense">Driver's License # <span class="required">*</span></label>
                                <input type="text" id="driversLicense" name="driversLicense" required>
                            </div>
                            <div class="form-group">
                                <label for="licenseState">State <span class="required">*</span></label>
                                <input type="text" id="licenseState" name="licenseState" maxlength="2" placeholder="CA" required>
                            </div>
                        </div>
                    </div>

                    <!-- Contact Information -->
                    <div class="form-section" id="section-contact" data-section="contact">
                        <h3><span class="section-icon">📱</span> Contact Information</h3>
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="cellPhone">Cell Phone # <span class="required">*</span></label>
                                <input type="tel" id="cellPhone" name="cellPhone" required autocomplete="tel" placeholder="(555) 555-5555" inputmode="tel">
                                <span class="input-hint">We'll use this to contact you about your application</span>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="homePhone">Home Phone # (Optional)</label>
                                <input type="tel" id="homePhone" name="homePhone" autocomplete="tel" placeholder="(555) 555-5555" inputmode="tel">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="email">Email Address <span class="required">*</span></label>
                                <input type="email" id="email" name="email" required autocomplete="email" placeholder="you@example.com" inputmode="email">
                                <span class="input-hint">Application updates will be sent to this email</span>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label>Gender</label>
                                <div class="radio-group">
                                    <label><input type="radio" name="gender" value="male"> Male</label>
                                    <label><input type="radio" name="gender" value="female"> Female</label>
                                    <label><input type="radio" name="gender" value="other"> Other</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label>Marital Status</label>
                                <div class="radio-group">
                                    <label><input type="radio" name="maritalStatus" value="single"> Single</label>
                                    <label><input type="radio" name="maritalStatus" value="married"> Married</label>
                                    <label><input type="radio" name="maritalStatus" value="divorced"> Divorced</label>
                                    <label><input type="radio" name="maritalStatus" value="widowed"> Widowed</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Address Information -->
                    <div class="form-section" id="section-address" data-section="address">
                        <h3><span class="section-icon">🏠</span> Current Address</h3>
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="presentAddress">Street Address <span class="required">*</span></label>
                                <input type="text" id="presentAddress" name="presentAddress" required autocomplete="street-address" placeholder="123 Main St">
                            </div>
                        </div>
                        
                        <div class="form-row three-col">
                            <div class="form-group">
                                <label for="currentCity">City <span class="required">*</span></label>
                                <input type="text" id="currentCity" name="currentCity" required autocomplete="address-level2">
                            </div>
                            <div class="form-group">
                                <label for="currentState">State</label>
                                <input type="text" id="currentState" name="currentState" maxlength="2" placeholder="CA" autocomplete="address-level1">
                            </div>
                            <div class="form-group">
                                <label for="currentZip">ZIP</label>
                                <input type="text" id="currentZip" name="currentZip" maxlength="5" autocomplete="postal-code">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="datesOfResidence">Move-In Date</label>
                                <input type="date" id="datesOfResidence" name="datesOfResidence">
                            </div>
                            <div class="form-group">
                                <label for="residenceTo">Move-Out Date</label>
                                <input type="date" id="residenceTo" name="residenceTo">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="monthlyPayment">Monthly Rent/Mortgage</label>
                                <input type="number" id="monthlyPayment" name="monthlyPayment" step="0.01" placeholder="1200.00">
                                <span class="input-hint">Enter amount without $ sign</span>
                            </div>
                            <div class="form-group">
                                <label>Rent or Own?</label>
                                <div class="radio-group">
                                    <label><input type="radio" name="rentedOwned" value="rented"> Rent</label>
                                    <label><input type="radio" name="rentedOwned" value="owned"> Own</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="managementName">Landlord/Management Name</label>
                                <input type="text" id="managementName" name="managementName">
                            </div>
                            <div class="form-group">
                                <label for="managementPhone">Landlord Phone</label>
                                <input type="tel" id="managementPhone" name="managementPhone" placeholder="(555) 555-5555">
                            </div>
                        </div>
                    </div>

                    <!-- Previous Address (Collapsible) -->
                    <div class="collapsible-section">
                        <div class="section-toggle" onclick="toggleSection('prevAddress')">
                            <span><strong>🏘️ Previous Address</strong> <em>(if less than 2 years at current address)</em></span>
                            <span class="toggle-icon" id="prevAddress-icon">▼</span>
                        </div>
                        <div class="section-content" id="prevAddress-content">
                            <div class="form-row">
                                <div class="form-group full-width">
                                    <label for="previousAddress">Street Address</label>
                                    <input type="text" id="previousAddress" name="previousAddress" placeholder="456 Elm St">
                                </div>
                            </div>
                            
                            <div class="form-row three-col">
                                <div class="form-group">
                                    <label for="prevCity">City</label>
                                    <input type="text" id="prevCity" name="prevCity">
                                </div>
                                <div class="form-group">
                                    <label for="prevState">State</label>
                                    <input type="text" id="prevState" name="prevState" maxlength="2" placeholder="CA">
                                </div>
                                <div class="form-group">
                                    <label for="prevZip">ZIP</label>
                                    <input type="text" id="prevZip" name="prevZip" maxlength="5">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="prevDatesOfResidence">Move-In Date</label>
                                    <input type="date" id="prevDatesOfResidence" name="prevDatesOfResidence">
                                </div>
                                <div class="form-group">
                                    <label for="prevResidenceTo">Move-Out Date</label>
                                    <input type="date" id="prevResidenceTo" name="prevResidenceTo">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="prevMonthlyPayment">Monthly Rent/Mortgage</label>
                                    <input type="number" id="prevMonthlyPayment" name="prevMonthlyPayment" step="0.01" placeholder="1000.00">
                                </div>
                                <div class="form-group">
                                    <label>Rent or Own?</label>
                                    <div class="radio-group">
                                        <label><input type="radio" name="prevRentedOwned" value="rented"> Rent</label>
                                        <label><input type="radio" name="prevRentedOwned" value="owned"> Own</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="prevManagementName">Landlord/Management Name</label>
                                    <input type="text" id="prevManagementName" name="prevManagementName">
                                </div>
                                <div class="form-group">
                                    <label for="prevManagementPhone">Landlord Phone</label>
                                    <input type="tel" id="prevManagementPhone" name="prevManagementPhone">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Other Occupants -->
                    <div class="form-section" id="section-occupants" data-section="occupants">
                        <h3><span class="section-icon">👥</span> Other Occupants</h3>
                        
                        <!-- Column Headers -->
                        <div class="form-row" style="margin-bottom: 0.5rem; display: grid; grid-template-columns: 30px 2fr 1fr 1.2fr; gap: 0.75rem;">
                            <div style="font-weight: 600; font-size: 0.85rem;"></div>
                            <div style="font-weight: 600; font-size: 0.85rem; color: #2c5530;">Full Name:</div>
                            <div style="font-weight: 600; font-size: 0.85rem; color: #2c5530;">D.O.B:</div>
                            <div style="font-weight: 600; font-size: 0.85rem; color: #2c5530;">Relationship:</div>
                        </div>
                        
                        <!-- Occupant 1 -->
                        <div class="form-row" style="margin-bottom: 0.5rem; display: grid; grid-template-columns: 30px 2fr 1fr 1.2fr; gap: 0.75rem;">
                            <div style="font-weight: 600; font-size: 0.85rem; color: #2c5530; display: flex; align-items: center;">1</div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <input type="text" id="occupant1Name" name="occupant1Name" style="width: 100%;">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <input type="date" id="occupant1DOB" name="occupant1DOB" style="width: 100%;">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <input type="text" id="occupant1Relationship" name="occupant1Relationship" style="width: 100%;">
                            </div>
                        </div>
                        
                        <!-- Occupant 2 -->
                        <div class="form-row" style="margin-bottom: 0.5rem; display: grid; grid-template-columns: 30px 2fr 1fr 1.2fr; gap: 0.75rem;">
                            <div style="font-weight: 600; font-size: 0.85rem; color: #2c5530; display: flex; align-items: center;">2</div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <input type="text" id="occupant2Name" name="occupant2Name" style="width: 100%;">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <input type="date" id="occupant2DOB" name="occupant2DOB" style="width: 100%;">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <input type="text" id="occupant2Relationship" name="occupant2Relationship" style="width: 100%;">
                            </div>
                        </div>
                        
                        <!-- Occupant 3 -->
                        <div class="form-row" style="margin-bottom: 0.5rem; display: grid; grid-template-columns: 30px 2fr 1fr 1.2fr; gap: 0.75rem;">
                            <div style="font-weight: 600; font-size: 0.85rem; color: #2c5530; display: flex; align-items: center;">3</div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <input type="text" id="occupant3Name" name="occupant3Name" style="width: 100%;">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <input type="date" id="occupant3DOB" name="occupant3DOB" style="width: 100%;">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <input type="text" id="occupant3Relationship" name="occupant3Relationship" style="width: 100%;">
                            </div>
                        </div>
                        
                        <!-- Occupant 4 -->
                        <div class="form-row" style="margin-bottom: 0; display: grid; grid-template-columns: 30px 2fr 1fr 1.2fr; gap: 0.75rem;">
                            <div style="font-weight: 600; font-size: 0.85rem; color: #2c5530; display: flex; align-items: center;">4</div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <input type="text" id="occupant4Name" name="occupant4Name" style="width: 100%;">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <input type="date" id="occupant4DOB" name="occupant4DOB" style="width: 100%;">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <input type="text" id="occupant4Relationship" name="occupant4Relationship" style="width: 100%;">
                            </div>
                        </div>
                    </div>

                    <!-- Employment Information -->
                    <div class="form-section" id="section-employment" data-section="employment">
                        <h3><span class="section-icon">💼</span> Employment Information</h3>
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="currentEmployer">Current Employer <span class="required">*</span></label>
                                <input type="text" id="currentEmployer" name="currentEmployer" required autocomplete="organization">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="position">Job Title/Position <span class="required">*</span></label>
                                <input type="text" id="position" name="position" required autocomplete="organization-title">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="employmentStartDate">Start Date</label>
                                <input type="date" id="employmentStartDate" name="employmentStartDate">
                            </div>
                            <div class="form-group">
                                <label for="monthlyIncome">Monthly Income</label>
                                <input type="number" id="monthlyIncome" name="monthlyIncome" step="0.01" placeholder="4000.00" inputmode="decimal">
                                <span class="input-hint">Enter your gross monthly income before taxes</span>
                                <span class="input-hint">Gross monthly income</span>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="supervisorName">Supervisor Name</label>
                                <input type="text" id="supervisorName" name="supervisorName">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="employerAddress">Employer Address</label>
                                <input type="text" id="employerAddress" name="employerAddress" placeholder="789 Business Blvd, City, State ZIP">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="employerPhone">Employer Phone</label>
                                <input type="tel" id="employerPhone" name="employerPhone" placeholder="(555) 555-5555">
                            </div>
                        </div>
                    </div>

                    <!-- References -->
                    <div class="form-section" id="section-references" data-section="references">
                        <h3><span class="section-icon">📋</span> References</h3>
                        <p style="font-size: 0.875rem; color: #666; margin-bottom: 1rem;">Please provide at least 2 personal or professional references (non-relatives)</p>
                        
                        <!-- Reference 1 -->
                        <h4 style="color: #2c5530; font-size: 1rem; margin-bottom: 0.75rem;">Reference 1</h4>
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="ref1Name">Full Name <span class="required">*</span></label>
                                <input type="text" id="ref1Name" name="ref1Name" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="ref1Relationship">Relationship <span class="required">*</span></label>
                                <input type="text" id="ref1Relationship" name="ref1Relationship" placeholder="Friend, Colleague, etc." required>
                            </div>
                            <div class="form-group">
                                <label for="ref1YearsKnown">Years Known</label>
                                <input type="number" id="ref1YearsKnown" name="ref1YearsKnown" min="0" max="99" placeholder="5">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="ref1Phone">Phone Number <span class="required">*</span></label>
                                <input type="tel" id="ref1Phone" name="ref1Phone" placeholder="(555) 555-5555" required>
                            </div>
                            <div class="form-group">
                                <label for="ref1Email">Email</label>
                                <input type="email" id="ref1Email" name="ref1Email" placeholder="reference@email.com">
                            </div>
                        </div>
                        
                        <!-- Reference 2 -->
                        <h4 style="color: #2c5530; font-size: 1rem; margin: 1.5rem 0 0.75rem;">Reference 2 <span style="color: #666; font-weight: 400; font-size: 0.875rem;">(Optional)</span></h4>
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="ref2Name">Full Name <span class="required">*</span></label>
                                <input type="text" id="ref2Name" name="ref2Name" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="ref2Relationship">Relationship <span class="required">*</span></label>
                                <input type="text" id="ref2Relationship" name="ref2Relationship" placeholder="Friend, Colleague, etc." required>
                            </div>
                            <div class="form-group">
                                <label for="ref2YearsKnown">Years Known</label>
                                <input type="number" id="ref2YearsKnown" name="ref2YearsKnown" min="0" max="99" placeholder="3">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="ref2Phone">Phone Number <span class="required">*</span></label>
                                <input type="tel" id="ref2Phone" name="ref2Phone" placeholder="(555) 555-5555" required>
                            </div>
                            <div class="form-group">
                                <label for="ref2Email">Email</label>
                                <input type="email" id="ref2Email" name="ref2Email" placeholder="reference@email.com">
                            </div>
                        </div>
                        
                        <!-- Reference 3 (Optional) -->
                        <h4 style="color: #2c5530; font-size: 1rem; margin: 1.5rem 0 0.75rem;">Reference 3 <span style="color: #666; font-weight: 400; font-size: 0.875rem;">(Optional)</span></h4>
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="ref3Name">Full Name</label>
                                <input type="text" id="ref3Name" name="ref3Name">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="ref3Relationship">Relationship</label>
                                <input type="text" id="ref3Relationship" name="ref3Relationship" placeholder="Friend, Colleague, etc.">
                            </div>
                            <div class="form-group">
                                <label for="ref3Phone">Phone Number</label>
                                <input type="tel" id="ref3Phone" name="ref3Phone" placeholder="(555) 555-5555">
                            </div>
                        </div>
                    </div>


                    <!-- Pets -->
                    <div class="form-section" id="section-pets" data-section="pets">
                        <h3><span class="section-icon">🐾</span> Pets</h3>
                        
                        <div class="yes-no-question" style="margin-bottom: 1rem;">
                            <label>Do you have any pets?</label>
                            <div class="yes-no-buttons">
                                <button type="button" class="yes-no-btn" onclick="toggleYesNo(this, 'hasPets', 'yes')" data-value="yes">Yes</button>
                                <button type="button" class="yes-no-btn" onclick="toggleYesNo(this, 'hasPets', 'no')" data-value="no">No</button>
                            </div>
                            <input type="hidden" id="hasPets" name="hasPets">
                        </div>
                        
                        <div class="yes-no-question" style="margin-bottom: 0.75rem;">
                            <label>If yes, how many?</label>
                            <div class="yes-no-buttons">
                                <button type="button" class="yes-no-btn" onclick="toggleYesNo(this, 'petCount', '1')" data-value="1">1</button>
                                <button type="button" class="yes-no-btn" onclick="toggleYesNo(this, 'petCount', '2')" data-value="2">2</button>
                                <button type="button" class="yes-no-btn" onclick="toggleYesNo(this, 'petCount', '3+')" data-value="3+">3 or more</button>
                            </div>
                            <input type="hidden" id="petCount" name="petCount">
                        </div>
                        
                        <!-- Pet 1 -->
                        <div class="pet-group" style="padding: 0.5rem 0.75rem; margin-bottom: 0.75rem; background: #f8f9fa; border-radius: 4px; border-left: 3px solid #4a7c59;">
                            <div style="font-weight: 600; font-size: 0.85rem; color: #2c5530; margin-bottom: 0.5rem;">Pet 1</div>
                            <div class="form-row two-col" style="margin-bottom: 0.5rem;">
                                <div class="form-group">
                                    <label for="pet1Type">Type</label>
                                    <input type="text" id="pet1Type" name="pet1Type" placeholder="e.g., Dog" style="font-size: 0.85rem;">
                                </div>
                                <div class="form-group">
                                    <label for="pet1Breed">Breed</label>
                                    <input type="text" id="pet1Breed" name="pet1Breed" placeholder="e.g., Labrador" style="font-size: 0.85rem;">
                                </div>
                            </div>
                            <div class="form-row two-col" style="margin-bottom: 0.5rem;">
                                <div class="form-group">
                                    <label for="pet1Color">Color</label>
                                    <input type="text" id="pet1Color" name="pet1Color" placeholder="e.g., Brown" style="font-size: 0.85rem;">
                                </div>
                                <div class="form-group">
                                    <label for="pet1Weight">Weight</label>
                                    <input type="text" id="pet1Weight" name="pet1Weight" placeholder="lbs" style="font-size: 0.85rem;">
                                </div>
                            </div>
                            <div class="form-row two-col" style="margin-bottom: 0;">
                                <div class="form-group">
                                    <label for="pet1Age">Age</label>
                                    <input type="text" id="pet1Age" name="pet1Age" placeholder="Years" style="font-size: 0.85rem;">
                                </div>
                                <div class="form-group">
                                    <label for="pet1Name">Name</label>
                                    <input type="text" id="pet1Name" name="pet1Name" placeholder="Pet's name" style="font-size: 0.85rem;">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Pet 2 -->
                        <div class="pet-group" style="padding: 0.5rem 0.75rem; margin-bottom: 0; background: #f8f9fa; border-radius: 4px; border-left: 3px solid #4a7c59;">
                            <div style="font-weight: 600; font-size: 0.85rem; color: #2c5530; margin-bottom: 0.5rem;">Pet 2</div>
                            <div class="form-row two-col" style="margin-bottom: 0.5rem;">
                                <div class="form-group">
                                    <label for="pet2Type">Type</label>
                                    <input type="text" id="pet2Type" name="pet2Type" placeholder="e.g., Dog" style="font-size: 0.85rem;">
                                </div>
                                <div class="form-group">
                                    <label for="pet2Breed">Breed</label>
                                    <input type="text" id="pet2Breed" name="pet2Breed" placeholder="e.g., Labrador" style="font-size: 0.85rem;">
                                </div>
                            </div>
                            <div class="form-row two-col" style="margin-bottom: 0.5rem;">
                                <div class="form-group">
                                    <label for="pet2Color">Color</label>
                                    <input type="text" id="pet2Color" name="pet2Color" placeholder="e.g., Brown" style="font-size: 0.85rem;">
                                </div>
                                <div class="form-group">
                                    <label for="pet2Weight">Weight</label>
                                    <input type="text" id="pet2Weight" name="pet2Weight" placeholder="lbs" style="font-size: 0.85rem;">
                                </div>
                            </div>
                            <div class="form-row two-col" style="margin-bottom: 0;">
                                <div class="form-group">
                                    <label for="pet2Age">Age</label>
                                    <input type="text" id="pet2Age" name="pet2Age" placeholder="Years" style="font-size: 0.85rem;">
                                </div>
                                <div class="form-group">
                                    <label for="pet2Name">Name</label>
                                    <input type="text" id="pet2Name" name="pet2Name" placeholder="Pet's name" style="font-size: 0.85rem;">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Vehicle Information -->
                    <div class="form-section" id="section-vehicle" data-section="vehicle">
                        <h3><span class="section-icon">🚗</span> Vehicle Information</h3>
                        <p style="font-size: 0.875rem; color: #666; margin-bottom: 1rem;">Please provide information for all vehicles that will be parked at the property</p>
                        
                        <!-- Vehicle 1 -->
                        <h4 style="color: #2c5530; font-size: 1rem; margin-bottom: 0.75rem;">Primary Vehicle</h4>
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label for="vehicle1Make">Make <span class="required">*</span></label>
                                <input type="text" id="vehicle1Make" name="vehicle1Make" placeholder="e.g., Toyota" required>
                            </div>
                            <div class="form-group">
                                <label for="vehicle1Model">Model <span class="required">*</span></label>
                                <input type="text" id="vehicle1Model" name="vehicle1Model" placeholder="e.g., Camry" required>
                            </div>
                        </div>
                        
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label for="vehicle1Year">Year <span class="required">*</span></label>
                                <input type="number" id="vehicle1Year" name="vehicle1Year" min="1900" max="2030" placeholder="2020" required>
                            </div>
                            <div class="form-group">
                                <label for="vehicle1Color">Color <span class="required">*</span></label>
                                <input type="text" id="vehicle1Color" name="vehicle1Color" placeholder="e.g., Silver" required>
                            </div>
                        </div>
                        
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label for="vehicle1License">License Plate Number <span class="required">*</span></label>
                                <input type="text" id="vehicle1License" name="vehicle1License" placeholder="ABC1234" required style="text-transform: uppercase;">
                            </div>
                            <div class="form-group">
                                <label for="vehicle1State">State <span class="required">*</span></label>
                                <select id="vehicle1State" name="vehicle1State" required>
                                    <option value="">Select state</option>
                                    <option value="AL">Alabama</option>
                                    <option value="AZ">Arizona</option>
                                    <option value="CA">California</option>
                                    <option value="FL">Florida</option>
                                    <option value="GA">Georgia</option>
                                    <option value="IL">Illinois</option>
                                    <option value="NY">New York</option>
                                    <option value="TX">Texas</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Vehicle 2 (Optional) -->
                        <h4 style="color: #2c5530; font-size: 1rem; margin: 1.5rem 0 0.75rem;">Second Vehicle <span style="color: #666; font-weight: 400; font-size: 0.875rem;">(Optional)</span></h4>
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label for="vehicle2Make">Make</label>
                                <input type="text" id="vehicle2Make" name="vehicle2Make" placeholder="e.g., Honda">
                            </div>
                            <div class="form-group">
                                <label for="vehicle2Model">Model</label>
                                <input type="text" id="vehicle2Model" name="vehicle2Model" placeholder="e.g., Accord">
                            </div>
                        </div>
                        
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label for="vehicle2Year">Year</label>
                                <input type="number" id="vehicle2Year" name="vehicle2Year" min="1900" max="2030" placeholder="2019">
                            </div>
                            <div class="form-group">
                                <label for="vehicle2Color">Color</label>
                                <input type="text" id="vehicle2Color" name="vehicle2Color" placeholder="e.g., Black">
                            </div>
                        </div>
                        
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label for="vehicle2License">License Plate Number</label>
                                <input type="text" id="vehicle2License" name="vehicle2License" placeholder="XYZ5678" style="text-transform: uppercase;">
                            </div>
                            <div class="form-group">
                                <label for="vehicle2State">State</label>
                                <select id="vehicle2State" name="vehicle2State">
                                    <option value="">Select state</option>
                                    <option value="AL">Alabama</option>
                                    <option value="AZ">Arizona</option>
                                    <option value="CA">California</option>
                                    <option value="FL">Florida</option>
                                    <option value="GA">Georgia</option>
                                    <option value="IL">Illinois</option>
                                    <option value="NY">New York</option>
                                    <option value="TX">Texas</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                        </div>
                    </div>
                    <!-- Emergency Contact -->
                    <div class="form-section" id="section-emergency" data-section="emergency">
                        <h3><span class="section-icon">🚨</span> Emergency Contact</h3>
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="emergencyName">Full Name <span class="required">*</span></label>
                                <input type="text" id="emergencyName" name="emergencyName" required>
                            </div>
                        </div>
                        
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label for="emergencyRelationship">Relationship</label>
                                <input type="text" id="emergencyRelationship" name="emergencyRelationship" placeholder="Mother, Friend, etc.">
                            </div>
                            <div class="form-group">
                                <label for="emergencyPhone">Phone Number <span class="required">*</span></label>
                                <input type="tel" id="emergencyPhone" name="emergencyPhone" required placeholder="(555) 555-5555">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="emergencyAddress">Address</label>
                                <input type="text" id="emergencyAddress" name="emergencyAddress" placeholder="123 Oak St, City, State ZIP">
                            </div>
                        </div>
                    </div>

                    <!-- Other Information -->
                    <div class="form-section" id="section-additional" data-section="additional">
                        <h3><span class="section-icon">�</span> Other Information</h3>
                        
                        <h4 style="color: #2c5530; font-size: 0.95rem; margin-bottom: 0.75rem; font-weight: 600;">Rental History Questions:</h4>
                        
                        <div class="yes-no-question" style="margin-bottom: 0.75rem;">
                            <label>Have you ever been evicted from rental housing?</label>
                            <div class="yes-no-buttons">
                                <button type="button" class="yes-no-btn" onclick="toggleYesNo(this, 'evictedRental', 'yes')" data-value="yes">Yes</button>
                                <button type="button" class="yes-no-btn" onclick="toggleYesNo(this, 'evictedRental', 'no')" data-value="no">No</button>
                            </div>
                            <input type="hidden" id="evictedRental" name="evictedRental">
                        </div>
                        
                        <div class="yes-no-question" style="margin-bottom: 0.75rem;">
                            <label>Has a landlord ever refused to renew a lease with you?</label>
                            <div class="yes-no-buttons">
                                <button type="button" class="yes-no-btn" onclick="toggleYesNo(this, 'refusedRenewal', 'yes')" data-value="yes">Yes</button>
                                <button type="button" class="yes-no-btn" onclick="toggleYesNo(this, 'refusedRenewal', 'no')" data-value="no">No</button>
                            </div>
                            <input type="hidden" id="refusedRenewal" name="refusedRenewal">
                        </div>
                        
                        <div class="yes-no-question" style="margin-bottom: 1.5rem;">
                            <label>Do you currently have any outstanding debt to a landlord?</label>
                            <div class="yes-no-buttons">
                                <button type="button" class="yes-no-btn" onclick="toggleYesNo(this, 'landlordDebt', 'yes')" data-value="yes">Yes</button>
                                <button type="button" class="yes-no-btn" onclick="toggleYesNo(this, 'landlordDebt', 'no')" data-value="no">No</button>
                            </div>
                            <input type="hidden" id="landlordDebt" name="landlordDebt">
                        </div>
                        
                        <h4 style="color: #2c5530; font-size: 0.95rem; margin-bottom: 0.75rem; font-weight: 600;">Background History Questions:</h4>
                        
                        <div class="yes-no-question" style="margin-bottom: 0.75rem;">
                            <label>Have you been convicted of any criminal offense (misdemeanor or felony)?</label>
                            <div class="yes-no-buttons">
                                <button type="button" class="yes-no-btn" onclick="toggleYesNo(this, 'criminalOffense', 'yes')" data-value="yes">Yes</button>
                                <button type="button" class="yes-no-btn" onclick="toggleYesNo(this, 'criminalOffense', 'no')" data-value="no">No</button>
                            </div>
                            <input type="hidden" id="criminalOffense" name="criminalOffense">
                        </div>
                        
                        <div class="yes-no-question" style="margin-bottom: 0.75rem;">
                            <label>Have you ever been part of a plea agreement relating to any criminal activity?</label>
                            <div class="yes-no-buttons">
                                <button type="button" class="yes-no-btn" onclick="toggleYesNo(this, 'pleaAgreement', 'yes')" data-value="yes">Yes</button>
                                <button type="button" class="yes-no-btn" onclick="toggleYesNo(this, 'pleaAgreement', 'no')" data-value="no">No</button>
                            </div>
                            <input type="hidden" id="pleaAgreement" name="pleaAgreement">
                        </div>
                        
                        <div class="yes-no-question" style="margin-bottom: 0.75rem;">
                            <label>Have you been arrested, accused, detained, convicted or otherwise involved in any sex related crime?</label>
                            <div class="yes-no-buttons">
                                <button type="button" class="yes-no-btn" onclick="toggleYesNo(this, 'sexCrime', 'yes')" data-value="yes">Yes</button>
                                <button type="button" class="yes-no-btn" onclick="toggleYesNo(this, 'sexCrime', 'no')" data-value="no">No</button>
                            </div>
                            <input type="hidden" id="sexCrime" name="sexCrime">
                        </div>
                        
                        <div class="yes-no-question" style="margin-bottom: 0;">
                            <label>Have you ever been listed on any sex offender registry?</label>
                            <div class="yes-no-buttons">
                                <button type="button" class="yes-no-btn" onclick="toggleYesNo(this, 'sexOffenderRegistry', 'yes')" data-value="yes">Yes</button>
                                <button type="button" class="yes-no-btn" onclick="toggleYesNo(this, 'sexOffenderRegistry', 'no')" data-value="no">No</button>
                            </div>
                            <input type="hidden" id="sexOffenderRegistry" name="sexOffenderRegistry">
                        </div>
                        
                        <h4 style="color: #2c5530; font-size: 0.95rem; margin-bottom: 0.75rem; margin-top: 1.5rem; font-weight: 600;">Additional Questions:</h4>
                        
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="vacatingReason">Why are you vacating your current residence?</label>
                                <textarea id="vacatingReason" name="vacatingReason" rows="3" placeholder="Please explain..."></textarea>
                            </div>
                        </div>
                        
                        <div class="yes-no-question" style="margin-bottom: 0.75rem;">
                            <label>Have you given proper written notice to vacate to your current landlord?</label>
                            <div class="yes-no-buttons">
                                <button type="button" class="yes-no-btn" onclick="toggleYesNo(this, 'givenNotice', 'yes')" data-value="yes">Yes</button>
                                <button type="button" class="yes-no-btn" onclick="toggleYesNo(this, 'givenNotice', 'no')" data-value="no">No</button>
                            </div>
                            <input type="hidden" id="givenNotice" name="givenNotice">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="howHeard">How did you hear about us?</label>
                                <textarea id="howHeard" name="howHeard" rows="2" placeholder="Please tell us..."></textarea>
                            </div>
                        </div>
                        
                        <div class="form-row" style="margin-top: 2rem; margin-bottom: 0;">
                            <div class="form-group full-width">
                                <p style="font-size: 0.875rem; line-height: 1.6; color: #333; margin-bottom: 1rem;">
                                    I certify that the above information is correct and complete and hereby authorize Golden Hills Real Estate to review credit check and make any inquiries necessary to evaluate my tenancy and credit standing. I understand that giving incomplete or false information is grounds for immediate rejection of this application and/or termination of my tenancy. I certify that I have received, read and understand the rental qualifications of Golden Hills Real Estate. I understand that a holding deposit of $300 (if approved), plus a non-refundable application fee of $25 is due at the time that I submit this application, and should I cancel within 48 hours of submitting this application or if my application is denied for any reason, my holding deposit of $300 is refundable. I understand and agree that if I cancel my application after 48 hours for any reason, my holding deposit is non-refundable.
                                </p>
                            </div>
                        </div>
                        
                        <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-bottom: 0;">
                            <div class="form-group">
                                <label for="printName">Print Name:</label>
                                <input type="text" id="printName" name="printName">
                            </div>
                            <div class="form-group">
                                <label for="signature">Signature:</label>
                                <input type="text" id="signature" name="signature" placeholder="Type your name">
                            </div>
                            <div class="form-group">
                                <label for="signatureDate">Date:</label>
                                <input type="date" id="signatureDate" name="signatureDate">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
                
                <div class="form-actions">
                    <div class="btn-group">
                        <button type="submit" form="rentalApplicationForm" class="btn-form btn-primary">
                            ✅ Submit Application
                        </button>
                        <button type="button" onclick="printForm()" class="btn-form btn-outline">
                            🖨️ Print
                        </button>
                        <a href="rental-application.html" class="btn-form btn-outline">
                            📄 PDF Version
                        </a>
                    </div>
                    <p style="margin-top: 1rem; color: #666; font-size: 0.875rem; text-align: center;">
                        Questions? <a href="contact.html" style="color: #4a7c59; text-decoration: underline;">Contact us</a>
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Save Draft Button (Mobile) -->
        <button class="save-draft-btn" onclick="saveAsDraft()" title="Save Draft">
            💾
        </button>
        
        <!-- Loading Overlay -->
        <div class="form-loading" id="formLoading">
            <div class="spinner"></div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Section Navigator Functions
        function scrollToSection(sectionName) {
            const section = document.getElementById('section-' + sectionName);
            const header = document.querySelector('.form-header');
            
            if (section && header) {
                // Scroll to section with offset for the integrated header (header now contains navigator)
                const offset = header.offsetHeight + 10; // Dynamic header height + small padding
                const elementPosition = section.getBoundingClientRect().top;
                const offsetPosition = elementPosition + window.pageYOffset - offset;
                
                window.scrollTo({
                    top: offsetPosition,
                    behavior: 'smooth'
                });
                
                // Update active tab
                updateActiveTab(sectionName);
            }
        }
        
        function updateActiveTab(sectionName) {
            // Remove active class from all tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Add active class to clicked tab
            const activeTab = document.querySelector(`[data-section="${sectionName}"]`);
            if (activeTab) {
                activeTab.classList.add('active');
            }
        }
        
        // Check section completion status
        function checkSectionCompletion() {
            const sections = ['personal', 'contact', 'address', 'employment', 'references', 'bank', 'vehicle', 'background', 'emergency', 'additional'];
            
            sections.forEach(sectionName => {
                const section = document.getElementById('section-' + sectionName);
                if (!section) return;
                
                // Get all required inputs in this section
                const requiredInputs = section.querySelectorAll('input[required], select[required], textarea[required]');
                
                if (requiredInputs.length === 0) {
                    // No required fields, mark as complete
                    markSectionComplete(sectionName, true);
                    return;
                }
                
                // Check if all required fields are filled
                const allFilled = Array.from(requiredInputs).every(input => {
                    if (input.type === 'radio') {
                        const radioGroup = section.querySelectorAll(`input[name="${input.name}"]`);
                        return Array.from(radioGroup).some(radio => radio.checked);
                    } else if (input.type === 'checkbox') {
                        return input.checked;
                    }
                    return input.value.trim() !== '';
                });
                
                markSectionComplete(sectionName, allFilled);
            });
        }
        
        function markSectionComplete(sectionName, isComplete) {
            const tab = document.querySelector(`.nav-tab[data-section="${sectionName}"]`);
            if (!tab) return;
            
            if (isComplete) {
                tab.classList.add('completed');
            } else {
                tab.classList.remove('completed');
            }
        }
        
        // Track which section is in viewport
        function updateActiveSection() {
            const sections = document.querySelectorAll('.form-section[data-section]');
            const header = document.querySelector('.form-header');
            const scrollPosition = window.scrollY + (header ? header.offsetHeight + 10 : 130);
            
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionBottom = sectionTop + section.offsetHeight;
                
                if (scrollPosition >= sectionTop && scrollPosition < sectionBottom) {
                    const sectionName = section.getAttribute('data-section');
                    updateActiveTab(sectionName);
                }
            });
        }
        
        // Listen for scroll to update active section
        let scrollTimeout;
        window.addEventListener('scroll', () => {
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(() => {
                updateActiveSection();
                ensureNavigatorVisible(); // Ensure navigator stays visible
            }, 100);
        });
        
        // Polyfill: Ensure header with integrated navigator stays visible
        function ensureNavigatorVisible() {
            const header = document.querySelector('.form-header');
            
            if (!header) return;
            
            // Since navigator is now inside header, we just need to ensure header is sticky
            const headerRect = header.getBoundingClientRect();
            
            // If header has scrolled away (not at top), force it back
            if (window.scrollY > 0 && headerRect.top !== 0) {
                // Re-apply sticky positioning to header
                header.style.position = 'sticky';
                header.style.top = '0';
                header.style.zIndex = '100';
            }
        }
        
        // Toggle collapsible sections
        function toggleSection(sectionId) {
            const content = document.getElementById(sectionId + '-content');
            const icon = document.getElementById(sectionId + '-icon');
            const toggle = content.previousElementSibling;
            
            content.classList.toggle('active');
            icon.classList.toggle('active');
            toggle.classList.toggle('active');
        }
        
        // Toggle Yes/No buttons
        function toggleYesNo(button, inputId, value) {
            const input = document.getElementById(inputId);
            const buttonsContainer = button.parentElement;
            const allButtons = buttonsContainer.querySelectorAll('.yes-no-btn');
            
            // Remove active class from all buttons
            allButtons.forEach(btn => btn.classList.remove('active'));
            
            // Add active class to clicked button
            button.classList.add('active');
            
            // Set the hidden input value
            input.value = value;
        }
        
        // Update progress bar and section completion
        function updateProgress() {
            const form = document.getElementById('rentalApplicationForm');
            const inputs = form.querySelectorAll('input[required], select[required], textarea[required]');
            const filled = Array.from(inputs).filter(input => {
                if (input.type === 'radio') {
                    return form.querySelector(`input[name="${input.name}"]:checked`);
                }
                return input.value.trim() !== '';
            }).length;
            
            const progress = Math.round((filled / inputs.length) * 100);
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('currentStep').textContent = progress + '%';
            
            // Also check section completion
            checkSectionCompletion();
        }
        
        // Listen for input changes
        document.getElementById('rentalApplicationForm').addEventListener('input', updateProgress);
        document.getElementById('rentalApplicationForm').addEventListener('change', updateProgress);
        
        // Initialize progress and section completion on load
        window.addEventListener('DOMContentLoaded', () => {
            initializeStickyElements();
            updateProgress();
            checkSectionCompletion();
            updateActiveSection();
        });
        
        // Initialize sticky elements (mobile-first approach)
        function initializeStickyElements() {
            const header = document.querySelector('.form-header');
            
            if (!header) return;
            
            // Test if sticky is supported
            const isStickySupported = CSS.supports('position', 'sticky') || 
                                      CSS.supports('position', '-webkit-sticky');
            
            if (!isStickySupported) {
                // Fallback for browsers that don't support sticky
                console.warn('Sticky positioning not supported, using fallback');
                implementStickyFallback();
            } else {
                // Ensure sticky is properly applied to header (navigator is inside it now)
                header.style.position = 'sticky';
                header.style.top = '0';
                header.style.zIndex = '100';
            }
            
            // Add resize listener to recalculate positions
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    ensureNavigatorVisible();
                }, 150);
            });
        }
        
        // Fallback for browsers without sticky support
        function implementStickyFallback() {
            const header = document.querySelector('.form-header');
            
            if (!header) return;
            
            // Use fixed positioning as fallback
            let ticking = false;
            
            window.addEventListener('scroll', () => {
                if (!ticking) {
                    window.requestAnimationFrame(() => {
                        const scrollY = window.scrollY || window.pageYOffset;
                        
                        // Make header fixed (navigator is inside header now)
                        if (scrollY > 0) {
                            header.style.position = 'fixed';
                            header.style.top = '0';
                            header.style.left = '0';
                            header.style.right = '0';
                            header.style.width = '100%';
                        } else {
                            header.style.position = 'sticky';
                        }
                        
                        ticking = false;
                    });
                    
                    ticking = true;
                }
            });
        }
        
        // Auto-save to localStorage
        let saveTimeout;
        function autoSave() {
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                saveAsDraft(true);
            }, 2000);
        }
        
        document.getElementById('rentalApplicationForm').addEventListener('input', autoSave);
        
        // Save form data as draft
        function saveAsDraft(silent = false) {
            const form = document.getElementById('rentalApplicationForm');
            const formData = new FormData(form);
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }
            
            localStorage.setItem('rentalApplicationDraft', JSON.stringify(data));
            localStorage.setItem('draftTimestamp', new Date().toISOString());
            
            if (!silent) {
                showMessage('success', '✅ Draft saved successfully!');
            }
        }
        
        // Load draft on page load
        function loadDraft() {
            const draft = localStorage.getItem('rentalApplicationDraft');
            if (draft) {
                const data = JSON.parse(draft);
                const timestamp = localStorage.getItem('draftTimestamp');
                const date = timestamp ? new Date(timestamp).toLocaleDateString() : 'Unknown';
                
                if (confirm(`Found a saved draft from ${date}. Would you like to load it?`)) {
                    const form = document.getElementById('rentalApplicationForm');
                    for (let [key, value] of Object.entries(data)) {
                        const input = form.elements[key];
                        if (input) {
                            if (input.type === 'radio') {
                                const radio = form.querySelector(`input[name="${key}"][value="${value}"]`);
                                if (radio) radio.checked = true;
                            } else {
                                input.value = value;
                            }
                        }
                    }
                    updateProgress();
                }
            }
        }
        
        // Load draft on page load
        window.addEventListener('load', loadDraft);
        
        // Format phone numbers automatically as user types
        function formatPhoneNumber(value) {
            // Remove all non-digits
            const digits = value.replace(/\D/g, '');
            
            // Format as (XXX) XXX-XXXX
            if (digits.length <= 3) {
                return digits;
            } else if (digits.length <= 6) {
                return `(${digits.substring(0, 3)}) ${digits.substring(3)}`;
            } else {
                return `(${digits.substring(0, 3)}) ${digits.substring(3, 6)}-${digits.substring(6, 10)}`;
            }
        }
        
        const phoneInputs = document.querySelectorAll('input[type="tel"]');
        phoneInputs.forEach(input => {
            input.addEventListener('input', function(e) {
                const cursorPosition = this.selectionStart;
                const oldLength = this.value.length;
                
                this.value = formatPhoneNumber(this.value);
                
                const newLength = this.value.length;
                const diff = newLength - oldLength;
                
                // Adjust cursor position
                if (diff > 0) {
                    this.selectionStart = this.selectionEnd = cursorPosition + diff;
                } else {
                    this.selectionStart = this.selectionEnd = cursorPosition;
                }
            });
        });
        
        // Format SSN automatically as user types
        function formatSSN(value) {
            // Remove all non-digits
            const digits = value.replace(/\D/g, '');
            
            // Format as XXX-XX-XXXX
            if (digits.length <= 3) {
                return digits;
            } else if (digits.length <= 5) {
                return `${digits.substring(0, 3)}-${digits.substring(3)}`;
            } else {
                return `${digits.substring(0, 3)}-${digits.substring(3, 5)}-${digits.substring(5, 9)}`;
            }
        }
        
        const ssnInput = document.getElementById('socialSecurity');
        if (ssnInput) {
            ssnInput.addEventListener('input', function(e) {
                const cursorPosition = this.selectionStart;
                const oldLength = this.value.length;
                
                this.value = formatSSN(this.value);
                
                const newLength = this.value.length;
                const diff = newLength - oldLength;
                
                // Adjust cursor position
                if (diff > 0) {
                    this.selectionStart = this.selectionEnd = cursorPosition + diff;
                } else {
                    this.selectionStart = this.selectionEnd = cursorPosition;
                }
            });
        }
        
        // Show success/error messages
        function showMessage(type, message) {
            const messageEl = document.getElementById(type === 'success' ? 'successMessage' : 'errorMessage');
            messageEl.textContent = message;
            messageEl.classList.add('active');
            
            setTimeout(() => {
                messageEl.classList.remove('active');
            }, 3000);
            
            // Scroll to top to show message
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // Print form
        function printForm() {
            window.print();
        }
        
        // Form submission handler - PHP backend submission
        function handleFormSubmission(event) {
            event.preventDefault();
            
            // Show loading
            document.getElementById('formLoading').classList.add('active');
            
            // Validate required fields
            const form = document.getElementById('rentalApplicationForm');
            if (!form.checkValidity()) {
                document.getElementById('formLoading').classList.remove('active');
                showMessage('error', '⚠️ Please fill in all required fields');
                form.reportValidity();
                return;
            }
            
            // Collect form data
            const formData = new FormData(form);
            const applicationData = {};
            
            for (let [key, value] of formData.entries()) {
                applicationData[key] = value;
            }
            
            // Add submission timestamp
            applicationData.submissionDate = new Date().toISOString();
            applicationData.submissionTimestamp = Date.now();
            
            // Submit to PHP endpoint (works on standard web hosting!)
            fetch('submit_application.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(applicationData)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Server error: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                // Hide loading
                document.getElementById('formLoading').classList.remove('active');
                
                // Clear draft after successful submission
                localStorage.removeItem('rentalApplicationDraft');
                localStorage.removeItem('draftTimestamp');
                
                // Clear form
                form.reset();
                
                // Show success message
                showMessage('success', '✅ Application submitted successfully! We will contact you soon.');
                
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
                console.log('✅ Application submitted:', data);
            })
            .catch(error => {
                // Hide loading
                document.getElementById('formLoading').classList.remove('active');
                
                // Show error message
                showMessage('error', '❌ Error submitting application. Please try again or contact us directly.');
                
                console.error('❌ Submission error:', error);
                
                // Save as draft in case of error
                try {
                    localStorage.setItem('rentalApplicationDraft', JSON.stringify(applicationData));
                    localStorage.setItem('draftTimestamp', Date.now());
                    showMessage('info', '💾 Your data has been saved locally. You can try submitting again.');
                } catch (e) {
                    console.error('Error saving draft:', e);
                }
            });
        }
        
        // Load draft data if available
        document.addEventListener('DOMContentLoaded', function() {
            const draftData = localStorage.getItem('rentalApplicationDraft');
            if (draftData) {
                try {
                    const data = JSON.parse(draftData);
                    for (let [key, value] of Object.entries(data)) {
                        const element = document.querySelector(`[name="${key}"]`);
                        if (element) {
                            if (element.type === 'radio') {
                                const radio = document.querySelector(`[name="${key}"][value="${value}"]`);
                                if (radio) radio.checked = true;
                            } else {
                                element.value = value;
                            }
                        }
                    }
                    
                    if (confirm('📋 Draft data found! Would you like to load your previously saved information?')) {
                        // Data already loaded above
                        console.log('Draft data loaded successfully');
                    } else {
                        localStorage.removeItem('rentalApplicationDraft');
                    }
                } catch (error) {
                    console.error('Error loading draft data:', error);
                }
            }
        });
    </script>

    <!-- Admin Menu -->
    <div id="adminMenu">
        <button onclick="openUserManagement()">👥 Manage Users</button>
        <button onclick="handleLogout()">🚪 Logout</button>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Admin Login</h2>
                <button class="modal-close" onclick="closeLoginModal()">×</button>
            </div>
            <form onsubmit="handleLogin(event)">
                <div class="error-message" id="loginError"></div>
                <div class="form-group">
                    <label for="loginUsername">Username</label>
                    <input type="text" id="loginUsername" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeLoginModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Sign In</button>
                </div>
            </form>
        </div>
    </div>

    <!-- User Management Modal -->
    <div id="userManagementModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>User Management</h2>
                <button class="modal-close" onclick="closeUserManagement()">×</button>
            </div>
            <div class="user-management-header">
                <div>
                    <p style="color: #666; margin: 0;">Manage administrator accounts</p>
                </div>
                <button class="btn-add-user" onclick="openAddUserModal()">➕ Add User</button>
            </div>
            <table class="users-table">
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Created</th>
                        <th>Last Login</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="usersTableBody">
                    <!-- Users will be loaded here -->
                </tbody>
            </table>
            <div class="modal-actions" style="margin-top: 25px;">
                <button class="btn btn-secondary" onclick="closeUserManagement()">Close</button>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New User</h2>
                <button class="modal-close" onclick="closeAddUserModal()">×</button>
            </div>
            <form id="addUserForm" onsubmit="handleAddUser(event)">
                <div class="error-message" id="addUserError"></div>
                <div class="form-group">
                    <label for="newUsername">Username *</label>
                    <input type="text" id="newUsername" required minlength="3">
                </div>
                <div class="form-group">
                    <label for="newEmail">Email *</label>
                    <input type="email" id="newEmail" required>
                </div>
                <div class="form-group">
                    <label for="newPassword">Password *</label>
                    <input type="password" id="newPassword" required minlength="6">
                </div>
                <div class="form-group">
                    <label for="newRole">Role *</label>
                    <select id="newRole" required>
                        <option value="administrator">Administrator</option>
                        <option value="user">User</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAddUserModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save User</button>
                </div>
            </form>
        </div>
    </div>

    <script src="admin-auth.js"></script>
</body>
</html>
